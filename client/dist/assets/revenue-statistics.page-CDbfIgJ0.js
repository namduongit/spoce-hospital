import{u as E,r as o,j as e}from"./index-wOwRfMo4.js";import{g as B}from"./service-invoice.service-Bud_1WFk.js";import{g as L}from"./prescription-invoice.service-BAoEDBLy.js";import{g as $}from"./appointment.service-pkTqRrMy.js";const G=()=>{const{execute:g,loading:D}=E(),[h,A]=o.useState([]),[u,R]=o.useState([]),[p,S]=o.useState([]),[c,N]=o.useState({fromDate:"",toDate:"",groupBy:"day"}),[j,P]=o.useState([]),[b,k]=o.useState([]),[w,T]=o.useState([]),y=(t,a)=>{N(l=>({...l,[t]:a}))},I=async()=>{const[t,a,l]=await Promise.all([g(B()),g(L()),g($())]);if(t?.result){const n=t.data;A(Array.isArray(n)?n:[])}if(a?.result){const n=a.data;R(Array.isArray(n)?n:[])}if(l?.result){const n=l.data;S(Array.isArray(n)?n:[])}};o.useEffect(()=>{I()},[]),o.useEffect(()=>{C()},[h,u,p,c]);const v=t=>{let a=t;return c.fromDate&&(a=a.filter(l=>{const n="createAt"in l?l.createAt:l.createdAt,d=new Date(n),x=new Date(c.fromDate);return d>=x})),c.toDate&&(a=a.filter(l=>{const n="createAt"in l?l.createAt:l.createdAt,d=new Date(n),x=new Date(c.toDate);return x.setHours(23,59,59,999),d<=x})),a},f=t=>{const a=t.getFullYear(),l=t.getMonth(),n=t.getDate();switch(c.groupBy){case"day":return`${n}/${l+1}/${a}`;case"week":return`Tuần ${Math.ceil(n/7)} - Tháng ${l+1}/${a}`;case"month":return`Tháng ${l+1}/${a}`;case"year":return`Năm ${a}`;default:return t.toISOString()}},C=()=>{const t=v(h.filter(r=>r.status==="PAID")),a=v(u.filter(r=>r.status==="PAID")),l=v(p.filter(r=>r.createdAt)),n=new Map;t.forEach(r=>{const s=f(new Date(r.createAt)),i=n.get(s)||{period:s,serviceRevenue:0,prescriptionRevenue:0,totalRevenue:0,appointmentCount:0};i.serviceRevenue+=r.totalAmount,i.totalRevenue+=r.totalAmount,n.set(s,i)}),a.forEach(r=>{const s=f(new Date(r.createAt)),i=n.get(s)||{period:s,serviceRevenue:0,prescriptionRevenue:0,totalRevenue:0,appointmentCount:0};i.prescriptionRevenue+=r.totalAmount,i.totalRevenue+=r.totalAmount,n.set(s,i)}),l.forEach(r=>{const s=f(new Date(r.createdAt)),i=n.get(s);i?i.appointmentCount+=1:n.set(s,{period:s,serviceRevenue:0,prescriptionRevenue:0,totalRevenue:0,appointmentCount:1})}),P(Array.from(n.values()).sort((r,s)=>s.totalRevenue-r.totalRevenue));const d=new Map;t.forEach(r=>{r.medicalPackages?.forEach(s=>{const i=d.get(s.medicalPackageName)||{packageName:s.medicalPackageName,quantity:0,revenue:0};i.quantity+=1,i.revenue+=s.price,d.set(s.medicalPackageName,i)})}),k(Array.from(d.values()).sort((r,s)=>s.revenue-r.revenue));const x=new Map;a.forEach(r=>{r.medicines?.forEach(s=>{const i=x.get(s.medicineName)||{medicineName:s.medicineName,quantity:0,revenue:0};i.quantity+=s.quantity,i.revenue+=s.unitPrice*s.quantity,x.set(s.medicineName,i)})}),T(Array.from(x.values()).sort((r,s)=>s.revenue-r.revenue))},m={totalServiceRevenue:h.filter(t=>t.status==="PAID").reduce((t,a)=>t+a.totalAmount,0),totalPrescriptionRevenue:u.filter(t=>t.status==="PAID").reduce((t,a)=>t+a.totalAmount,0),totalAppointments:p.length,paidServiceInvoices:h.filter(t=>t.status==="PAID").length,paidPrescriptionInvoices:u.filter(t=>t.status==="PAID").length,totalRevenue:0};m.totalRevenue=m.totalServiceRevenue+m.totalPrescriptionRevenue;const M=()=>{alert("Chức năng xuất báo cáo đang được phát triển")};return D?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsx("main",{className:"revenue-statistics-page p-4 sm:p-6",children:e.jsxs("div",{className:"revenue-statistics-page__wrap max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-blue-700",children:"Thống kê doanh thu"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Phân tích doanh thu và lợi nhuận theo thời gian"})]}),e.jsxs("button",{onClick:M,className:"mt-3 sm:mt-0 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:[e.jsx("i",{className:"fa-solid fa-file-export mr-2"}),"Xuất báo cáo"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-money-bill-wave text-green-600 text-xl"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tổng doanh thu"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:[(m.totalRevenue/1e6).toFixed(1),"M"]})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-hand-holding-medical text-blue-600 text-xl"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"DT Dịch vụ"}),e.jsxs("p",{className:"text-lg font-semibold text-blue-600",children:[(m.totalServiceRevenue/1e6).toFixed(1),"M"]})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-pills text-purple-600 text-xl"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"DT Thuốc"}),e.jsxs("p",{className:"text-lg font-semibold text-purple-600",children:[(m.totalPrescriptionRevenue/1e6).toFixed(1),"M"]})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-calendar-check text-orange-600 text-xl"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tổng lịch hẹn"}),e.jsx("p",{className:"text-lg font-semibold text-orange-600",children:m.totalAppointments})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Từ ngày"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",value:c.fromDate,onChange:t=>y("fromDate",t.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Đến ngày"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",value:c.toDate,onChange:t=>y("toDate",t.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nhóm theo"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",value:c.groupBy,onChange:t=>y("groupBy",t.target.value),children:[e.jsx("option",{value:"day",children:"Theo ngày"}),e.jsx("option",{value:"week",children:"Theo tuần"}),e.jsx("option",{value:"month",children:"Theo tháng"}),e.jsx("option",{value:"year",children:"Theo năm"})]})]}),(c.fromDate||c.toDate)&&e.jsxs("button",{onClick:()=>N(t=>({...t,fromDate:"",toDate:""})),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors text-sm font-medium",children:[e.jsx("i",{className:"fa-solid fa-times mr-1"}),"Xóa lọc"]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:[e.jsx("i",{className:"fa-solid fa-chart-line mr-2 text-blue-600"}),"Doanh thu theo thời gian"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Thời gian"}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-700",children:"DT Dịch vụ"}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-700",children:"DT Thuốc"}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-700",children:"Tổng doanh thu"}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-700",children:"Lịch hẹn"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:j.length>0?j.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:t.period}),e.jsxs("td",{className:"px-4 py-3 text-right text-blue-600",children:[t.serviceRevenue.toLocaleString("vi-VN")," đ"]}),e.jsxs("td",{className:"px-4 py-3 text-right text-purple-600",children:[t.prescriptionRevenue.toLocaleString("vi-VN")," đ"]}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-green-600",children:[t.totalRevenue.toLocaleString("vi-VN")," đ"]}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:t.appointmentCount})]},a)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500",children:"Không có dữ liệu trong khoảng thời gian này"})})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:[e.jsx("i",{className:"fa-solid fa-hand-holding-medical mr-2 text-blue-600"}),"Doanh thu theo gói dịch vụ"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Gói dịch vụ"}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-700",children:"SL"}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-700",children:"Doanh thu"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:b.length>0?b.slice(0,10).map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:t.packageName}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:t.quantity}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-blue-600",children:[t.revenue.toLocaleString("vi-VN")," đ"]})]},a)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"px-4 py-8 text-center text-gray-500",children:"Không có dữ liệu"})})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:[e.jsx("i",{className:"fa-solid fa-pills mr-2 text-purple-600"}),"Doanh thu theo thuốc"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Tên thuốc"}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-700",children:"SL"}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-700",children:"Doanh thu"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:w.length>0?w.slice(0,10).map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:t.medicineName}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:t.quantity}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-purple-600",children:[t.revenue.toLocaleString("vi-VN")," đ"]})]},a)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"px-4 py-8 text-center text-gray-500",children:"Không có dữ liệu"})})})]})})]})]})]})})};export{G as default};
