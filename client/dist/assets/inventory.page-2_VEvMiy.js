import{u as q,r as f,j as e,f as E}from"./index-wOwRfMo4.js";import{t as O}from"./medicine.constant-CpMBuXEb.js";import{a as V}from"./medicine.service-Cwwuf_rk.js";import{b as P,f as G}from"./format-date.util-D8g88DXU.js";import{c as X,b as H,d as B,e as K,g as Q,a as z}from"./export-ticket.service-C1qrhmXi.js";import{b as _,c as U}from"./report-print.service-Dl1us5Fl.js";const J=p=>{const{onClose:a,onSuccess:m,medicines:u}=p,{execute:T,notify:j,loading:c}=q(),[b,C]=f.useState({reason:"",supplierName:"",importDate:P(new Date)}),[h,g]=f.useState([]),N=(t,l)=>{C(s=>({...s,[t]:l}))},y=(t,l,s)=>{g(v=>{const w=[...v];if(w[t]={...w[t],[l]:s},l==="medicineId"){const k=u.find(D=>D.id.toString()===s);k&&(w[t].medicineName=k.name)}return w})},i=()=>{g(t=>[...t,{medicineId:"",medicineName:"",quantity:"",price:"",expiryDate:""}])},S=t=>{h.length>1&&g(l=>l.filter((s,v)=>v!==t))},o=()=>h.reduce((t,l)=>{const s=Number(l.quantity)||0,v=Number(l.price)||0;return t+s*v},0),n=async t=>{t.preventDefault();const l=await T(X({reason:b.reason,supplierName:b.supplierName,items:h.map(s=>({medicineId:Number(s.medicineId),quantity:Number(s.quantity),unitPrice:Number(s.price),expiryDate:s.expiryDate}))}));j(l,"Tạo phiếu nhập thành công"),l?.result&&(d(),m?.())},d=()=>{C({reason:"",supplierName:"",importDate:P(new Date)}),g([]),a()};return e.jsx("div",{className:"fixed top-0 left-0 bg-gray-400/60 w-full h-full z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-white px-8 py-6 rounded-lg shadow-lg w-full max-w-6xl mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Tạo phiếu nhập hàng"}),e.jsx("button",{onClick:d,className:"text-gray-500 hover:text-gray-700 text-xl font-bold",disabled:c,children:"x"})]}),e.jsxs("form",{onSubmit:n,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-4",children:"Thông tin phiếu nhập"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ngày nhập"}),e.jsx("input",{type:"date",value:b.importDate,onChange:t=>N("importDate",t.target.value),className:"w-full border rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 border-gray-300 transition-colors bg-gray-100",disabled:c,readOnly:!0}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Hôm nay: ",G(new Date)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lý do nhập hàng"}),e.jsx("input",{type:"text",value:b.reason,onChange:t=>N("reason",t.target.value),className:"w-full border rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 border-gray-300 transition-colors",placeholder:"VD: Nhập hàng định kỳ, Bổ sung tồn kho...",disabled:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tên nhà cung cấp"}),e.jsx("input",{type:"text",value:b.supplierName,onChange:t=>N("supplierName",t.target.value),className:"w-full border rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 border-gray-300 transition-colors",placeholder:"Nhập tên nhà cung cấp",disabled:c})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Chi tiết sản phẩm nhập"}),e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 transition",disabled:c,children:"+ Thêm sản phẩm"})]}),e.jsx("div",{className:"space-y-4",children:h.map((t,l)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("h4",{className:"text-md font-medium text-gray-700",children:["Sản phẩm #",l+1]}),h.length>1&&e.jsx("button",{type:"button",onClick:()=>S(l),className:"text-red-500 hover:text-red-700 text-sm font-medium",disabled:c,children:"Xóa"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Thuốc ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:t.medicineId,onChange:s=>y(l,"medicineId",s.target.value),className:"w-full border rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 border-gray-300 transition-colors",disabled:c,children:[e.jsx("option",{value:"",children:"Chọn thuốc"}),u.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.unit,") - ",E(s.price)]},s.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Số lượng ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:t.quantity,onChange:s=>y(l,"quantity",s.target.value),className:"w-full border rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 border-gray-300 transition-colors",placeholder:"Số lượng",min:"1",disabled:c})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Giá nhập (VNĐ) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:t.price,onChange:s=>y(l,"price",s.target.value),className:"w-full border rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 border-gray-300 transition-colors",placeholder:"Giá nhập",min:"0",step:"0.01",disabled:c}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:Number(t.price)>0&&`≈ ${E(Number(t.price))}`})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Ngày hết hạn ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:t.expiryDate,onChange:s=>y(l,"expiryDate",s.target.value),className:"w-full border rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 border-gray-300 transition-colors",disabled:c,min:P(new Date)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Thành tiền"}),e.jsx("div",{className:"w-full border rounded-md py-2 px-3 text-sm bg-gray-50 border-gray-300",children:E((Number(t.quantity)||0)*(Number(t.price)||0))})]})]})]},l))}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-700",children:"Tổng giá trị nhập:"}),e.jsx("span",{className:"text-xl font-bold text-blue-600",children:E(o())})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:d,className:"flex-1 max-w-32 px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition",disabled:c,children:"Hủy"}),e.jsx("button",{type:"submit",className:"flex-1 max-w-40 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition disabled:opacity-50",disabled:c,children:c?"Đang tạo...":"Tạo phiếu nhập"})]})]})]})})},W=p=>{const{onClose:a,onSuccess:m,medicines:u}=p,{execute:T,notify:j,loading:c}=q(),[b,C]=f.useState({reason:"",exportDate:P(new Date)}),[h,g]=f.useState([]),N=(t,l)=>{C(s=>({...s,[t]:l}))},y=(t,l,s)=>{g(v=>{const w=[...v];if(w[t]={...w[t],[l]:s},l==="medicineId"){const k=u.find(D=>D.id.toString()===s);k&&(w[t].medicineName=k.name,w[t].availableStock=k.currentStock||0)}return w})},i=()=>{g(t=>[...t,{medicineId:"",medicineName:"",quantity:"",availableStock:0}])},S=t=>{h.length>1&&g(l=>l.filter((s,v)=>v!==t))},o=()=>h.reduce((t,l)=>{const s=Number(l.quantity)||0;return t+s},0),n=async t=>{t.preventDefault();const l=await T(H({reason:b.reason,items:h.map(s=>({medicineId:Number(s.medicineId),quantity:Number(s.quantity)}))}));j(l,"Tạo phiếu xuất thành công"),l?.result&&(d(),m?.())},d=()=>{C({reason:"",exportDate:P(new Date)}),g([{medicineId:"",medicineName:"",quantity:"",availableStock:0}]),a()};return e.jsx("div",{className:"fixed top-0 left-0 bg-gray-400/60 w-full h-full z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-white px-8 py-6 rounded-lg shadow-lg w-full max-w-5xl mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Tạo phiếu xuất hàng"}),e.jsx("button",{onClick:d,className:"text-gray-500 hover:text-gray-700 text-xl font-bold",disabled:c,children:"x"})]}),e.jsxs("form",{onSubmit:n,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-4",children:"Thông tin phiếu xuất"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ngày xuất"}),e.jsx("input",{type:"date",value:b.exportDate,onChange:t=>N("exportDate",t.target.value),className:"w-full border rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 border-gray-300 transition-colors bg-gray-100",disabled:c,readOnly:!0}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Hôm nay: ",G(new Date)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lý do xuất hàng"}),e.jsx("input",{type:"text",value:b.reason,onChange:t=>N("reason",t.target.value),className:"w-full border rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 border-gray-300 transition-colors",placeholder:"VD: Bán lẻ, Trả hàng hết hạn, Hỏng hóc...",disabled:c})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Chi tiết sản phẩm xuất"}),e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 bg-red-600 text-white text-sm rounded-md hover:bg-red-700 transition",disabled:c,children:"+ Thêm sản phẩm"})]}),e.jsx("div",{className:"space-y-4",children:h.map((t,l)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("h4",{className:"text-md font-medium text-gray-700",children:["Sản phẩm #",l+1]}),h.length>1&&e.jsx("button",{type:"button",onClick:()=>S(l),className:"text-red-500 hover:text-red-700 text-sm font-medium",disabled:c,children:"Xóa"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Thuốc"}),e.jsxs("select",{value:t.medicineId,onChange:s=>y(l,"medicineId",s.target.value),className:"w-full border rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 border-gray-300 transition-colors",disabled:c,children:[e.jsx("option",{value:"",children:"Chọn thuốc"}),u.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.unit,") - Tồn: ",s.currentStock||0]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tồn kho hiện tại"}),e.jsx("div",{className:"w-full border rounded-md py-2 px-3 text-sm bg-gray-50 border-gray-300",children:e.jsxs("span",{className:`font-medium ${t.availableStock>0?"text-green-600":"text-red-600"}`,children:[t.availableStock," ",t.medicineName?u.find(s=>s.id.toString()===t.medicineId)?.unit:""]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Số lượng xuất"}),e.jsx("input",{type:"number",value:t.quantity,onChange:s=>y(l,"quantity",s.target.value),className:`w-full border rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${Number(t.quantity)>t.availableStock?"border-red-500 bg-red-50":"border-gray-300"}`,placeholder:"Số lượng",disabled:c}),Number(t.quantity)>t.availableStock&&t.availableStock>0&&e.jsx("div",{className:"text-xs text-red-500 mt-1",children:"Không đủ hàng trong kho!"})]})]})]},l))}),e.jsx("div",{className:"mt-4 p-4 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-700",children:"Tổng số lượng xuất:"}),e.jsxs("span",{className:"text-xl font-bold text-red-600",children:[o()," sản phẩm"]})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:d,className:"flex-1 max-w-32 px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition",disabled:c,children:"Hủy"}),e.jsx("button",{type:"submit",className:"flex-1 max-w-40 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition disabled:opacity-50",disabled:c,children:c?"Đang tạo...":"Tạo phiếu xuất"})]})]})]})})},Y=p=>{const{importTicket:a,onSuccess:m}=p,{execute:u,notify:T}=q(),[j,c]=f.useState(new Set),b=n=>{const d=new Set(j);d.has(n)?d.delete(n):d.add(n),c(d)},C=n=>{switch(n){case"COMPLETED":return{text:"Hoàn thành",color:"bg-green-100 text-green-800"};case"PENDING":return{text:"Chờ xử lý",color:"bg-yellow-100 text-yellow-800"};case"CANCELLED":return{text:"Đã hủy",color:"bg-red-100 text-red-800"};default:return{text:n,color:"bg-gray-100 text-gray-800"}}},h=n=>new Date(n).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),g=j.has(a.id),N=C(a.status),y=a.items.reduce((n,d)=>n+d.quantity*d.unitPrice,0),i=a.items.reduce((n,d)=>n+d.quantity,0),S=async n=>{const d=await u(B(a.id,n));T(d,"Cập nhật trạng thái phiếu nhập thành công"),d?.result&&m?.()},o=async()=>{const n=await u(_(a.id));T(n,"In phiếu nhập hàng thành công"),n?.result&&m?.()};return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 p-4 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>b(a.id),children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex-4 flex items-center space-x-10",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"shrink-0",children:e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-green-100",children:e.jsx("i",{className:"fa-solid fa-download text-green-600 text-sm"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Thực hiện bởi"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.performedBy})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Nhà cung cấp"}),e.jsx("p",{className:"font-medium text-gray-900 truncate",children:a.supplierName||"Chưa có thông tin"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Trạng thái"}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${N.color}`,children:N.text})]})]}),e.jsxs("div",{className:"flex-1 text-right flex justify-end items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Ngày tạo"}),e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:h(a.createdAt)}),e.jsxs("p",{className:"text-sm font-semibold text-green-600",children:[y.toLocaleString(),"đ"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[i," sản phẩm"]})]}),e.jsx("div",{className:"ml-4",children:e.jsx("i",{className:`fa-solid ${g?"fa-chevron-up":"fa-chevron-down"} text-gray-400`})})]})]})}),g&&e.jsxs("div",{className:"bg-white p-4 border-t border-gray-200",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Chi tiết phiếu nhập"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Lý do: "}),e.jsx("span",{className:"text-gray-900",children:a.reason})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Ngày cập nhật: "}),e.jsx("span",{className:"text-gray-900",children:h(a.updatedAt)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Nhà cung cấp: "}),e.jsx("span",{className:"text-gray-900",children:a.supplierName||"Chưa có thông tin"})]})]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Mã thuốc"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thuốc"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Số lượng"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Đơn giá"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thành tiền"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.items.map((n,d)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:n.medicineId}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:n.medicineName}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:n.quantity.toLocaleString()}),e.jsxs("td",{className:"px-4 py-2 text-sm text-gray-900",children:[n.unitPrice?.toLocaleString(),"đ"]}),e.jsx("td",{className:"px-4 py-2 text-sm font-medium text-gray-900",children:E(n.quantity*n.unitPrice)})]},d))}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"px-4 py-2 text-sm font-medium text-gray-900 text-left",children:"Tổng cộng:"}),e.jsx("td",{className:"px-4 py-2 text-sm font-bold text-gray-900",children:E(y)})]})})]}),e.jsxs("div",{className:"mt-4 flex justify-end space-x-2",children:[a.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2.5 rounded font-bold transition",onClick:()=>S("COMPLETED"),children:"Xác nhận"}),e.jsx("button",{className:"bg-red-600 text-white px-4 py-2.5 rounded font-bold transition",children:"Xóa phiếu"})]}),e.jsxs("button",{className:"bg-green-600 text-white px-4 py-2.5 rounded font-bold transition gap-2 flex items-center hover:bg-green-700",onClick:o,children:[e.jsx("i",{className:"fa-solid fa-print"}),e.jsx("span",{children:"In phiếu"})]})]})]})]})]},a.id)},R=({importTickets:p,reload:a})=>p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-24 w-24 text-gray-300 mb-4",children:e.jsx("i",{className:"fa-solid fa-download text-6xl"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Không có phiếu nhập nào"}),e.jsx("p",{className:"text-gray-500",children:"Chưa có phiếu nhập hàng nào được tạo."})]}):e.jsx("div",{className:"space-y-4",children:p.map(m=>e.jsx(Y,{importTicket:m,onSuccess:a},m.id))}),Z=p=>{const{exportTicket:a,onSuccess:m}=p,[u,T]=f.useState(new Set),{execute:j,notify:c}=q(),b=o=>{switch(o){case"COMPLETED":return{text:"Hoàn thành",color:"bg-green-100 text-green-800"};case"PENDING":return{text:"Chờ xử lý",color:"bg-yellow-100 text-yellow-800"};case"CANCELLED":return{text:"Đã hủy",color:"bg-red-100 text-red-800"};default:return{text:o,color:"bg-gray-100 text-gray-800"}}},C=o=>{const n=new Set(u);n.has(o)?n.delete(o):n.add(o),T(n)},h=o=>new Date(o).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),g=u.has(a.id),N=b(a.status),y=a.items.reduce((o,n)=>o+n.quantity,0),i=async()=>{const o=await j(U(a.id));c(o,"In phiếu xuất hàng thành công"),o?.result&&m?.()},S=async o=>{const n=await j(K(a.id,o));c(n,"Cập nhật trạng thái phiếu xuất thành công"),n?.result&&m?.()};return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 p-4 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>C(a.id),children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex-4 flex items-center space-x-10",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-red-100",children:e.jsx("i",{className:"fa-solid fa-upload text-red-600 text-sm"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Thực hiện bởi"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.performedBy})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Lý do"}),e.jsx("p",{className:"font-medium text-gray-900 truncate",children:a.reason})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Trạng thái"}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${N.color}`,children:N.text})]})]}),e.jsxs("div",{className:"flex-1 text-right flex justify-end items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Ngày tạo"}),e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:h(a.createdAt.toString())}),e.jsxs("p",{className:"text-xs text-gray-500",children:[y," sản phẩm"]})]}),e.jsx("div",{className:"ml-4",children:e.jsx("i",{className:`fa-solid ${g?"fa-chevron-up":"fa-chevron-down"} text-gray-400`})})]})]})}),g&&e.jsxs("div",{className:"bg-white p-4 border-t border-gray-200",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Chi tiết phiếu xuất"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Lý do: "}),e.jsx("span",{className:"text-gray-900",children:a.reason})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Ngày cập nhật: "}),e.jsx("span",{className:"text-gray-900",children:h(a.updatedAt.toString())})]})]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Mã thuốc"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thuốc"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Số lượng"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[a.items.map((o,n)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:o.medicineId}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:o.medicineName}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:o.quantity.toLocaleString()})]},n)),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 text-sm font-medium text-gray-900",colSpan:2,children:"Tổng cộng"}),e.jsx("td",{className:"px-4 py-2 text-sm font-bold text-gray-900",children:y.toLocaleString()})]})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end space-x-2",children:[a.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2.5 rounded font-bold transition",onClick:()=>S("COMPLETED"),children:"Xác nhận"}),e.jsx("button",{className:"bg-red-600 text-white px-4 py-2.5 rounded font-bold transition",children:"Xóa phiếu"})]}),e.jsxs("button",{className:"bg-green-600 text-white px-4 py-2.5 rounded font-bold transition gap-2 flex items-center hover:bg-green-700",onClick:i,children:[e.jsx("i",{className:"fa-solid fa-print"}),e.jsx("span",{children:"In phiếu"})]})]})]})]})]},a.id)},M=({exportTickets:p,reload:a})=>p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-24 w-24 text-gray-300 mb-4",children:e.jsx("i",{className:"fa-solid fa-upload text-6xl"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Không có phiếu xuất nào"}),e.jsx("p",{className:"text-gray-500",children:"Chưa có phiếu xuất hàng nào được tạo."})]}):e.jsx("div",{className:"space-y-4",children:p.map(m=>e.jsx(Z,{exportTicket:m,onSuccess:a},m.id))}),le=()=>{const{execute:p}=q(),[a,m]=f.useState("all"),[u,T]=f.useState([]),[j,c]=f.useState([]),[b,C]=f.useState([]),[h,g]=f.useState(!1),[N,y]=f.useState(!1),[i,S]=f.useState({input:"",status:"",type:"",dateFrom:"",dateTo:""}),o=(r,x)=>{S(L=>({...L,[r]:x}))},n=()=>{},d=f.useMemo(()=>u.filter(r=>{const x=!i.input||r.id.toString().includes(i.input.toLowerCase())||r.performedBy.toLowerCase().includes(i.input.toLowerCase())||r.supplierName&&r.supplierName.toLowerCase().includes(i.input.toLowerCase())||r.items.some(A=>A.medicineName.toLowerCase().includes(i.input.toLowerCase())||A.medicineId.toString().includes(i.input.toLowerCase())),L=!i.status||r.status===i.status,$=!i.dateFrom||new Date(r.createdAt)>=new Date(i.dateFrom),F=!i.dateTo||new Date(r.createdAt)<=new Date(i.dateTo+"T23:59:59");return x&&L&&$&&F}),[u,i]),t=f.useMemo(()=>j.filter(r=>{const x=!i.input||r.id.toString().includes(i.input.toLowerCase())||r.performedBy.toLowerCase().includes(i.input.toLowerCase())||r.items.some(A=>A.medicineName.toLowerCase().includes(i.input.toLowerCase())||A.medicineId.toString().includes(i.input.toLowerCase())),L=!i.status||r.status===i.status,$=!i.dateFrom||new Date(r.createdAt)>=new Date(i.dateFrom),F=!i.dateTo||new Date(r.createdAt)<=new Date(i.dateTo+"T23:59:59");return x&&L&&$&&F}),[j,i]),l=async()=>{const r=await p(Q());if(r?.result){const x=r.data;T(Array.isArray(x)?x:[])}},s=async()=>{const r=await p(z());if(r?.result){const x=r.data;c(Array.isArray(x)?x:[])}},v=async()=>{const r=await p(V());if(r?.result){const x=r.data;C(Array.isArray(x)?x:[])}},w=()=>{l(),v()},k=()=>{s(),v()},D=r=>{const x=r;return typeof x.totalAmount=="number"?x.totalAmount:typeof x.totalPrice=="number"?x.totalPrice:typeof x.amount=="number"?x.amount:0},I={totalTransactions:d.length+t.length,totalImports:d.length,totalExports:t.length,totalValue:d.reduce((r,x)=>r+D(x),0)+t.reduce((r,x)=>r+D(x),0),pendingTransactions:d.filter(r=>r.status==="PENDING").length+t.filter(r=>r.status==="PENDING").length};return f.useEffect(()=>{l(),s(),v()},[]),e.jsxs("main",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-blue-700 mb-2 sm:mb-0",children:"Quản lý nhập xuất kho"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Quản lý kho và xuất/nhập hàng"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Tổng giao dịch: ",e.jsx("span",{className:"font-semibold text-blue-600",children:I.totalTransactions})]}),e.jsxs("div",{children:["Chờ xử lý: ",e.jsx("span",{className:"font-semibold text-yellow-600",children:I.pendingTransactions})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-download text-green-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nhập hàng"}),e.jsx("p",{className:"text-lg font-semibold",children:I.totalImports})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-upload text-red-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Xuất hàng"}),e.jsx("p",{className:"text-lg font-semibold",children:I.totalExports})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-money-bill text-blue-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tổng giá trị"}),e.jsxs("p",{className:"text-lg font-semibold",children:[I.totalValue.toLocaleString(),"đ"]})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-clock text-yellow-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Chờ xử lý"}),e.jsx("p",{className:"text-lg font-semibold",children:I.pendingTransactions})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-3 grid-cols-1 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Tìm kiếm"}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"}),e.jsx("input",{type:"text",value:i.input,onChange:r=>o("input",r.target.value),className:"border border-gray-300 rounded-md py-2 pl-10 pr-4 text-sm w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Tìm kiếm theo thuốc, mã giao dịch...",onKeyPress:r=>r.key==="Enter"&&n()})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Trạng thái"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",value:i.status,onChange:r=>o("status",r.target.value),children:[e.jsx("option",{value:"",children:"Tất cả trạng thái"}),O.map(r=>e.jsx("option",{value:r.value.toUpperCase(),children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Từ ngày"}),e.jsx("input",{type:"date",value:i.dateFrom,onChange:r=>o("dateFrom",r.target.value),className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Đến ngày"}),e.jsx("input",{type:"date",value:i.dateTo,onChange:r=>o("dateTo",r.target.value),className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs("button",{onClick:n,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition text-sm font-medium flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-search"}),"Tìm kiếm"]}),e.jsxs("button",{onClick:()=>S({input:"",status:"",type:"",dateFrom:"",dateTo:""}),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition text-sm",children:[e.jsx("i",{className:"fa-solid fa-refresh me-1"}),"Xóa bộ lọc"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{className:`px-3 py-1 rounded text-sm font-medium transition-colors ${a==="all"?"bg-white text-blue-600 shadow":"text-gray-600"}`,onClick:()=>m("all"),children:"Tất cả"}),e.jsx("button",{className:`px-3 py-1 rounded text-sm font-medium transition-colors ${a==="import"?"bg-white text-blue-600 shadow":"text-gray-600"}`,onClick:()=>m("import"),children:"Nhập hàng"}),e.jsx("button",{className:`px-3 py-1 rounded text-sm font-medium transition-colors ${a==="export"?"bg-white text-blue-600 shadow":"text-gray-600"}`,onClick:()=>m("export"),children:"Xuất hàng"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"font-semibold bg-green-600 text-white hover:text-green-600 hover:bg-white hover:ring-2 hover:ring-green-600 px-4 py-2 rounded shadow cursor-pointer flex items-center text-sm transition-all",onClick:()=>g(!0),children:[e.jsx("i",{className:"fa-solid fa-download me-2"}),e.jsx("span",{children:"Nhập hàng"})]}),e.jsxs("button",{className:"font-semibold bg-red-600 text-white hover:text-red-600 hover:bg-white hover:ring-2 hover:ring-red-600 px-4 py-2 rounded shadow cursor-pointer flex items-center text-sm transition-all",onClick:()=>y(!0),children:[e.jsx("i",{className:"fa-solid fa-upload me-2"}),e.jsx("span",{children:"Xuất hàng"})]})]})]})]})}),e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"text-sm text-gray-600",children:["Hiển thị ",e.jsx("strong",{children:d.length+t.length})," / ",u.length+j.length," giao dịch"]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h4",{className:"text-lg font-semibold",children:[a==="all"&&"Lịch sử giao dịch",a==="import"&&"Phiếu nhập hàng",a==="export"&&"Phiếu xuất hàng",e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-2",children:[a==="all"&&`(${d.length+t.length} / ${u.length+j.length} giao dịch)`,a==="import"&&`(${d.length} / ${u.length} phiếu nhập)`,a==="export"&&`(${t.length} / ${j.length} phiếu xuất)`]})]})}),e.jsxs("div",{className:"space-y-4",children:[a==="all"&&e.jsxs(e.Fragment,{children:[d.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx("i",{className:"fa-solid fa-download text-green-600 mr-2"}),"Phiếu nhập hàng (",d.length,")"]}),e.jsx(R,{importTickets:d,reload:l})]}),t.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsxs("h5",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx("i",{className:"fa-solid fa-upload text-red-600 mr-2"}),"Phiếu xuất hàng (",t.length,")"]}),e.jsx(M,{exportTickets:t,reload:s})]}),d.length===0&&t.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-24 w-24 text-gray-300 mb-4",children:e.jsx("i",{className:"fa-solid fa-box-open text-6xl"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Không tìm thấy giao dịch nào"}),e.jsx("p",{className:"text-gray-500",children:"Không có giao dịch nào phù hợp với bộ lọc hiện tại."})]})]}),a==="import"&&e.jsx(R,{importTickets:d,reload:l}),a==="export"&&e.jsx(M,{exportTickets:t,reload:s})]})]})})})]}),h&&e.jsx(J,{medicines:b,onClose:()=>g(!1),onSuccess:w}),N&&e.jsx(W,{medicines:b,onClose:()=>y(!1),onSuccess:k})]})};export{le as default};
