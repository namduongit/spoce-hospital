import{d as O,u as R,r as l,j as e}from"./index-wOwRfMo4.js";import{a as E}from"./medicine.service-Cwwuf_rk.js";import{c as F}from"./prescription-invoice.service-BAoEDBLy.js";import{g as K}from"./account.service-mdvzvQaG.js";const G=()=>{const b=O(),{execute:o,notify:p,loading:m}=R(),[f,y]=l.useState([]),[c,j]=l.useState([]),[g,u]=l.useState([]),[x,N]=l.useState(""),[n,i]=l.useState({patientName:"",patientPhone:"",symptoms:"",note:"",userId:null,selectedMedicines:[]}),v=async()=>{const s=await o(K());if(s?.result){const t=s.data;y(Array.isArray(t)?t:[])}},I=async()=>{const s=await o(E());if(s?.result){const t=s.data;j(Array.isArray(t)?t:[]),u(Array.isArray(t)?t:[])}},w=s=>{if(N(s),s==="")u(c);else{const t=c.filter(r=>r.name.toLowerCase().includes(s.toLowerCase())||r.manufacturer.toLowerCase().includes(s.toLowerCase()));u(t)}},C=s=>{i(t=>({...t,userId:s}))},k=s=>{if(!n.selectedMedicines.some(t=>t.medicineId===s.id)){const t={medicineId:s.id,quantity:1,dosage:"",usageInstructions:""},r=[...n.selectedMedicines,t];i(a=>({...a,selectedMedicines:r}))}},S=s=>{const t=n.selectedMedicines.filter(r=>r.medicineId!==s);i(r=>({...r,selectedMedicines:t}))},h=(s,t)=>{if(t<=0)return;const r=n.selectedMedicines.map(a=>a.medicineId===s?{...a,quantity:t}:a);i(a=>({...a,selectedMedicines:r}))},M=(s,t)=>{const r=n.selectedMedicines.map(a=>a.medicineId===s?{...a,dosage:t}:a);i(a=>({...a,selectedMedicines:r}))},T=(s,t)=>{const r=n.selectedMedicines.map(a=>a.medicineId===s?{...a,usageInstructions:t}:a);i(a=>({...a,selectedMedicines:r}))},d=(s,t)=>{i(r=>({...r,[s]:t}))},A=async()=>{const s=await o(F({userId:n.userId,patientName:n.patientName,patientPhone:n.patientPhone,symptoms:n.symptoms,note:n.note,medicines:n.selectedMedicines.map(t=>({medicineId:t.medicineId,quantity:t.quantity,dosage:t.dosage,usageInstructions:t.usageInstructions}))}));p(s,"Tạo hóa đơn kê thuốc thành công")},L=s=>s==="USER"?"Bệnh nhân":s==="DOCTOR"?"Bác sĩ":s==="ASSISTOR"?"Trợ lý":"Quản trị viên",q=n.selectedMedicines.reduce((s,t)=>{const r=c.find(a=>a.id===t.medicineId);return s+(r?r.price*t.quantity:0)},0),P=s=>c.find(t=>t.id===s),V=s=>{switch(s){case"ACTIVE":return"text-green-800";case"INACTIVE":return"text-red-800";case"OUT_OF_STOCK":return"text-yellow-800";default:return"text-gray-800"}};return l.useEffect(()=>{v(),I()},[]),e.jsx("main",{className:"create-prescription-invoice-page p-4 sm:p-6",children:e.jsxs("div",{className:"create-prescription-invoice-page__wrap max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-blue-700",children:"Tạo hóa đơn kê thuốc"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Kê thuốc theo chỉ định của bác sĩ"})]}),e.jsxs("button",{onClick:()=>b("/doctor/prescription-invoice"),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:[e.jsx("i",{className:"fa-solid fa-arrow-left mr-2"}),"Quay lại"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fa-solid fa-user mr-2 text-blue-600"}),"Thông tin bệnh nhân"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Chọn tài khoản (tùy chọn)"}),e.jsxs("select",{value:n.userId||"",onChange:s=>C(s.target.value?Number(s.target.value):null),className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:m,children:[e.jsx("option",{value:"",children:"Không chọn tài khoản"}),f.map(s=>e.jsxs("option",{value:s.id,children:[s.id," - ",s.email," - ",L(s.role)]},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Họ tên"}),e.jsx("input",{type:"text",value:n.patientName,onChange:s=>d("patientName",s.target.value),className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nhập họ tên bệnh nhân",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Số điện thoại"}),e.jsx("input",{type:"tel",value:n.patientPhone,onChange:s=>d("patientPhone",s.target.value),className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nhập số điện thoại",maxLength:15})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Triệu chứng"}),e.jsx("input",{type:"text",value:n.symptoms,onChange:s=>d("symptoms",s.target.value),className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ghi chú"}),e.jsx("textarea",{value:n.note,onChange:s=>d("note",s.target.value),className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"Nhập ghi chú về tình trạng bệnh nhân hoặc lưu ý đặc biệt..."})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fa-solid fa-pills mr-2 text-blue-600"}),"Chọn thuốc"]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("i",{className:"fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"}),e.jsx("input",{type:"text",value:x,onChange:s=>w(s.target.value),className:"w-full border border-gray-300 rounded-md py-2 pl-10 pr-4 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Tìm kiếm thuốc..."})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2",children:g.length>0?g.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-md hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Nhà sản xuất: ",s.manufacturer]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Đơn vị: ",s.unit," | Tồn kho: ",s.currentStock]}),e.jsxs("p",{className:"text-sm text-gray-600 flex gap-2",children:["Trạng thái:",e.jsx("span",{className:`font-semibold ${V(s.status)}`,children:s.status==="ACTIVE"?"Hoạt động":s.status==="INACTIVE"?"Không hoạt động":s.status==="OUT_OF_STOCK"?"Hết hàng":"Không xác định"})]}),e.jsxs("p",{className:"text-sm font-semibold text-blue-600",children:[s.price.toLocaleString("vi-VN")," /",s.unit]})]}),e.jsxs("button",{onClick:()=>k(s),disabled:n.selectedMedicines.some(t=>t.medicineId===s.id),className:"ml-3 px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm font-medium disabled:bg-gray-300 disabled:cursor-not-allowed",children:[e.jsx("i",{className:"fa-solid fa-plus mr-1"}),n.selectedMedicines.some(t=>t.medicineId===s.id)?"Đã thêm":"Thêm"]})]},s.id)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fa-solid fa-search text-3xl mb-2"}),e.jsx("p",{children:x?`Không tìm thấy thuốc nào với từ khóa "${x}"`:"Không có thuốc nào khả dụng"})]})})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx("i",{className:"fa-solid fa-receipt mr-2 text-blue-600"}),"Chi tiết đơn thuốc"]}),n.selectedMedicines.length>0&&e.jsxs("span",{className:"text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:[n.selectedMedicines.length," loại thuốc"]})]}),e.jsx("div",{className:"space-y-4 mb-4",children:n.selectedMedicines.length>0?n.selectedMedicines.map(s=>{const t=P(s.medicineId);if(!t)return null;const r=t.price*s.quantity;return e.jsxs("div",{className:"p-4 bg-blue-50 rounded-md",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h6",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.price.toLocaleString("vi-VN")," /",t.unit]})]}),e.jsx("button",{onClick:()=>S(s.medicineId),className:"text-red-600 hover:text-red-700 transition-colors",children:e.jsx("i",{className:"fa-solid fa-trash"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Số lượng"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{type:"button",onClick:()=>h(s.medicineId,s.quantity-1),className:"px-2 py-1 bg-gray-200 text-gray-600 rounded-l-md hover:bg-gray-300 transition-colors",disabled:s.quantity<=1,children:"-"}),e.jsx("input",{type:"number",value:s.quantity,onChange:a=>h(s.medicineId,Number(a.target.value)),className:"w-16 text-center border-t border-b border-gray-200 py-1 text-sm",min:"1",max:t.currentStock}),e.jsx("button",{type:"button",onClick:()=>h(s.medicineId,s.quantity+1),className:"px-2 py-1 bg-gray-200 text-gray-600 rounded-r-md hover:bg-gray-300 transition-colors",disabled:s.quantity>=t.currentStock,children:"+"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Thành tiền"}),e.jsx("span",{className:"block py-1 text-sm font-semibold text-blue-600",children:r.toLocaleString("vi-VN")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Liều lượng"}),e.jsx("input",{type:"text",value:s.dosage,onChange:a=>M(s.medicineId,a.target.value),className:"w-full border border-gray-300 rounded-md py-1 px-2 text-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"VD: 2 viên x 3 lần/ngày"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Hướng dẫn sử dụng"}),e.jsx("input",{type:"text",value:s.usageInstructions,onChange:a=>T(s.medicineId,a.target.value),className:"w-full border border-gray-300 rounded-md py-1 px-2 text-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"VD: Sau ăn, uống 7 ngày"})]})]})]},s.medicineId)}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fa-solid fa-pills text-3xl mb-2"}),e.jsx("p",{children:"Chưa chọn thuốc nào"})]})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Tổng cộng:"}),e.jsxs("span",{className:"text-xl font-bold text-blue-600",children:[q.toLocaleString("vi-VN")," đ"]})]}),e.jsx("div",{className:"relative",children:e.jsx("button",{onClick:A,disabled:m,className:"w-full bg-green-600 text-white py-3 px-4 rounded-md hover:bg-green-700 transition-colors font-semibold",children:m?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-2"}),"Đang xử lý..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-plus mr-2"}),"Tạo hóa đơn kê thuốc"]})})})]})]})})]})]})})};export{G as default};
