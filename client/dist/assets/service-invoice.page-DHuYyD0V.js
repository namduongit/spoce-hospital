import{u as D,r as i,j as e,f as u}from"./index-wOwRfMo4.js";import{g as C}from"./service-invoice.service-Bud_1WFk.js";import{f as A}from"./format-date.util-D8g88DXU.js";import{s as E}from"./status.constant-BZ6KLHNH.js";import{S as P}from"./service-invoice.detail-DqKBC9zL.js";import{a as T}from"./report-print.service-Dl1us5Fl.js";const H=()=>{const{execute:o,notify:p}=D(),[l,f]=i.useState([]),[c,x]=i.useState([]),[j,m]=i.useState(!1),[h,N]=i.useState(null),[a,b]=i.useState({input:"",status:"",date:""}),d=(s,t)=>{b(n=>({...n,[s]:t}))},g=async()=>{const s=await o(C());if(s?.result){const t=s.data,n=Array.isArray(t)?t:[];f(n),x(n)}},y=()=>{let s=l;a.input.trim()&&(s=s.filter(t=>t.patientName.toLowerCase().includes(a.input.toLowerCase())||t.patientPhone.includes(a.input)||t.id.toString().includes(a.input)||t.doctorEmail.toLowerCase().includes(a.input.toLowerCase()))),a.status&&(s=s.filter(t=>t.status===a.status)),a.date==="ASC"?s=s.slice().sort((t,n)=>new Date(t.createAt).getTime()-new Date(n.createAt).getTime()):a.date==="DESC"&&(s=s.slice().sort((t,n)=>new Date(n.createAt).getTime()-new Date(t.createAt).getTime())),x(s)};i.useEffect(()=>{g()},[]),i.useEffect(()=>{y()},[a,l]);const r={totalInvoices:l.length,totalAmount:l.reduce((s,t)=>s+(t.totalAmount||0),0),totalPackages:l.reduce((s,t)=>s+(t.medicalPackages?.length||0),0),pendingInvoices:l.filter(s=>s.status==="PENDING").length,paidInvoices:l.filter(s=>s.status==="PAID").length,cancelledInvoices:l.filter(s=>s.status==="CANCELLED").length,todayInvoices:l.filter(s=>{const t=new Date().toDateString();return new Date(s.createAt).toDateString()===t}).length},v=s=>{switch(s){case"PENDING":return"text-yellow-600 bg-yellow-100";case"PAID":return"text-green-600 bg-green-100";case"CANCELLED":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},w=s=>{switch(s){case"PENDING":return"Chờ xử lý";case"PAID":return"Đã hoàn thành";case"CANCELLED":return"Đã hủy";default:return s}},S=s=>{N(s),m(!0)},I=async s=>{const t=await o(T(s.id));p(t,"In hóa đơn thành công")};return e.jsxs("main",{className:"service-invoice-page p-4 sm:p-6",children:[e.jsxs("div",{className:"service-invoice-page__wrap max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-blue-700 mb-2 sm:mb-0",children:"Quản lý hóa đơn dịch vụ"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Quản lý hóa đơn khám dịch vụ tại bệnh viện"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Tổng: ",e.jsx("span",{className:"font-semibold text-blue-600",children:r.totalInvoices})," hóa đơn"]}),e.jsxs("div",{children:["Hôm nay: ",e.jsx("span",{className:"font-semibold text-green-600",children:r.todayInvoices})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-receipt text-blue-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tổng hóa đơn"}),e.jsx("p",{className:"text-lg font-semibold",children:r.totalInvoices})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-clock text-yellow-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Chờ xử lý"}),e.jsx("p",{className:"text-lg font-semibold",children:r.pendingInvoices})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-check-circle text-green-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Đã hoàn thành"}),e.jsx("p",{className:"text-lg font-semibold",children:r.paidInvoices})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-times-circle text-red-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Đã hủy"}),e.jsx("p",{className:"text-lg font-semibold",children:r.cancelledInvoices})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-hand-holding-medical text-purple-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tổng gói DV"}),e.jsx("p",{className:"text-lg font-semibold",children:r.totalPackages})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-money-bill text-orange-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Doanh thu"}),e.jsxs("p",{className:"text-lg font-semibold",children:[(r.totalAmount/1e6).toFixed(1),"M"]})]})]})})]}),e.jsx("div",{className:"service-invoice__sort bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:e.jsxs("div",{className:"service-invoice__filter flex flex-col gap-3 sm:flex-row sm:items-center sm:space-x-3",children:[e.jsxs("div",{className:"service-invoice__filter__item relative flex-1",children:[e.jsx("i",{className:"fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"}),e.jsx("input",{type:"text",className:"border border-gray-300 rounded-md py-2 pl-10 pr-4 text-sm w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Tìm theo tên bệnh nhân, bác sĩ, mã hóa đơn...",value:a.input,onChange:s=>d("input",s.target.value)})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",value:a.status,onChange:s=>d("status",s.target.value),children:[e.jsx("option",{value:"",children:"Chọn trạng thái"}),E.map(s=>e.jsx("option",{value:s.value,children:s.name},s.id))]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",value:a.date,onChange:s=>d("date",s.target.value),children:[e.jsx("option",{value:"",children:"Sắp xếp theo ngày"}),e.jsx("option",{value:"DESC",children:"Mới nhất"}),e.jsx("option",{value:"ASC",children:"Cũ nhất"})]})})]})}),e.jsxs("div",{className:"service-invoice__data bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Mã HĐ"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Tên bệnh nhân"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Số điện thoại"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Email bác sĩ"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Số gói DV"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Ngày tạo"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Trạng thái"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Tổng tiền"}),e.jsx("th",{className:"px-4 py-3 text-center font-medium text-gray-700",children:"Thao tác"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:c.length>0?c.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 font-medium text-blue-600",children:["#",s.id]}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:s.patientName}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.patientPhone}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.doctorEmail}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs",children:[s.medicalPackages?.length||0," gói"]})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:A(new Date(s.createAt))}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${v(s.status)}`,children:w(s.status)})}),e.jsx("td",{className:"px-4 py-3 font-semibold text-blue-600",children:u(s.totalAmount)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("button",{onClick:()=>S(s),className:"px-3 py-1 bg-blue-100 text-blue-600 rounded hover:bg-blue-200 transition-colors text-xs font-medium",title:"Xem chi tiết",children:[e.jsx("i",{className:"fa-solid fa-eye mr-1"}),"Chi tiết"]}),e.jsxs("button",{onClick:()=>I(s),className:"px-3 py-1 bg-yellow-100 text-yellow-600 rounded hover:bg-yellow-200 transition-colors text-xs font-medium",title:"In hóa đơn",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"In hóa đơn"]})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-4 py-8 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("i",{className:"fa-solid fa-receipt text-4xl mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:"Không có hóa đơn dịch vụ nào"}),e.jsx("p",{className:"text-sm mt-1",children:"Chưa có dữ liệu để hiển thị"})]})})})})]})}),c.length>0&&e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:["Hiển thị ",e.jsx("span",{className:"font-medium",children:c.length})," trên tổng số ",e.jsx("span",{className:"font-medium",children:l.length})," hóa đơn"]}),e.jsxs("span",{children:["Tổng giá trị: ",e.jsx("span",{className:"font-semibold text-blue-600",children:u(c.reduce((s,t)=>s+t.totalAmount,0))})]})]})})]})]}),j&&h&&e.jsx(P,{serviceInvoiceSelect:h,setShowDetail:m,onSuccess:g})]})};export{H as default};
