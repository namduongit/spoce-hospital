import{u as v,r as l,j as e}from"./index-wOwRfMo4.js";import{a as k,g as w}from"./medicine.service-Cwwuf_rk.js";import{g as S,a as M}from"./export-ticket.service-C1qrhmXi.js";const D=()=>{const{execute:c}=v(),[a,u]=l.useState([]),[o,f]=l.useState([]),[x,j]=l.useState([]),[m,p]=l.useState([]),[b,h]=l.useState(!0),N=async()=>{h(!0);try{const[t,s,i,g]=await Promise.all([c(k()),c(w()),c(S()),c(M())]);t?.result&&u(t.data),s?.result&&f(s.data),i?.result&&j(i.data),g?.result&&p(g.data)}catch(t){console.error("Error fetching medicine dashboard data:",t)}finally{h(!1)}};l.useEffect(()=>{N()},[]);const r={totalMedicines:a.length,totalCategories:o.length,activeMedicines:a.filter(t=>t.status==="active").length,inactiveMedicines:a.filter(t=>t.status==="inactive").length,outOfStockMedicines:a.filter(t=>t.status==="out_of_stock").length,lowStockMedicines:a.filter(t=>t.currentStock<=t.minStock).length,overStockMedicines:a.filter(t=>t.currentStock>t.maxStock).length,totalCurrentStock:a.reduce((t,s)=>t+(s.currentStock||0),0),totalStockValue:a.reduce((t,s)=>t+(s.price*s.currentStock||0),0),averagePrice:a.length>0?a.reduce((t,s)=>t+(s.price||0),0)/a.length:0,highValueMedicines:a.filter(t=>t.price>1e5).length,totalImports:x.length,totalExports:m.length,recentImports:x.filter(t=>{const s=new Date;return s.setDate(s.getDate()-7),new Date(t.createdAt||0)>=s}).length,recentExports:m.filter(t=>{const s=new Date;return s.setDate(s.getDate()-7),new Date(t.createdAt||0)>=s}).length},d=o.map(t=>({name:t.name,count:a.filter(s=>s.categoryId===t.id).length,value:a.filter(s=>s.categoryId===t.id).reduce((s,i)=>s+(i.price*i.currentStock||0),0)})).sort((t,s)=>s.count-t.count),y=a.map(t=>({...t,totalValue:t.price*t.currentStock})).sort((t,s)=>s.totalValue-t.totalValue).slice(0,10),n=a.filter(t=>t.currentStock<=t.minStock||t.status==="out_of_stock").slice(0,8);return b?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("main",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Tổng quan thuốc"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Phân tích và thống kê kho thuốc"})]}),e.jsxs("div",{className:"flex gap-3 mt-4 sm:mt-0",children:[e.jsxs("a",{href:"/admin/medicine",className:"bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("i",{className:"fa-solid fa-pills mr-2"}),"Quản lý thuốc"]}),e.jsxs("a",{href:"/admin/inventory",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("i",{className:"fa-solid fa-boxes-stacked mr-2"}),"Nhập xuất kho"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg mr-3",children:e.jsx("i",{className:"fa-solid fa-pills text-blue-600"})}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Tổng số thuốc"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mb-2",children:r.totalMedicines}),e.jsx("div",{className:"text-xs text-gray-500",children:e.jsxs("div",{children:["Hoạt động: ",r.activeMedicines," • Ngừng: ",r.inactiveMedicines]})})]})})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"p-2 bg-green-50 rounded-lg mr-3",children:e.jsx("i",{className:"fa-solid fa-coins text-green-600"})}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Giá trị tồn kho"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mb-2",children:[r.totalStockValue/1e6," M VNĐ"]}),e.jsx("div",{className:"text-xs text-gray-500",children:e.jsxs("div",{children:["Giá TB: ",(r.averagePrice/1e3).toFixed(0),"K • Cao giá: ",r.highValueMedicines]})})]})})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"p-2 bg-purple-50 rounded-lg mr-3",children:e.jsx("i",{className:"fa-solid fa-box text-purple-600"})}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Số lượng tồn"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mb-2",children:r.totalCurrentStock.toLocaleString()}),e.jsx("div",{className:"text-xs text-gray-500",children:e.jsxs("div",{children:["Sắp hết: ",r.lowStockMedicines," • Hết: ",r.outOfStockMedicines]})})]})})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"p-2 bg-orange-50 rounded-lg mr-3",children:e.jsx("i",{className:"fa-solid fa-truck text-orange-600"})}),e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Hoạt động kho"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mb-2",children:r.recentImports+r.recentExports}),e.jsx("div",{className:"text-xs text-gray-500",children:e.jsxs("div",{children:["Nhập: ",r.recentImports," • Xuất: ",r.recentExports," (tuần)"]})})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Phân loại thuốc"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[r.totalCategories," loại"]})]}),e.jsxs("div",{className:"space-y-4",children:[d.slice(0,6).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-2 h-8 bg-blue-500 rounded-full"}),e.jsx("span",{className:"font-medium text-gray-900",children:t.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:t.count}),e.jsxs("div",{className:"text-sm text-gray-500",children:[t.value/1e6," M VNĐ"]})]})]},t.name)),d.length>6&&e.jsx("div",{className:"text-center pt-2",children:e.jsxs("a",{href:"/admin/medicine",className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:["Xem thêm ",d.length-6," loại khác →"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Cần chú ý"}),e.jsxs("div",{className:"flex items-center text-red-600 font-semibold",children:[e.jsx("i",{className:"fa-solid fa-bell"}),e.jsx("span",{className:"text-red-800 text-sm font-medium px-2 py-1 rounded-full",children:n.length})]})]}),e.jsx("div",{className:"space-y-3",children:n.length>0?n.map(t=>e.jsx("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.categoryName})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[t.currentStock<=t.minStock&&e.jsxs("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full",children:["Sắp hết: ",t.currentStock,"/",t.minStock]}),t.status==="out_of_stock"&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full",children:"Hết hàng"})]})})]})},t.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("i",{className:"fa-solid fa-check-circle text-green-500 text-3xl mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Tất cả thuốc đều trong tình trạng tốt"})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top thuốc theo giá trị tồn kho"}),e.jsx("a",{href:"/admin/medicine",className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Xem tất cả →"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Hạng"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Tên thuốc"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Loại"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-900",children:"Số lượng"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-900",children:"Giá"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-900",children:"Tổng giá trị"})]})}),e.jsx("tbody",{children:y.slice(0,8).map((t,s)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white ${s===0?"bg-yellow-500":s===1?"bg-gray-400":s===2?"bg-orange-600":"bg-gray-300"}`,children:s+1})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"font-medium text-gray-900",children:t.name})}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:t.categoryName}),e.jsx("td",{className:"py-3 px-4 text-right font-medium",children:t.currentStock}),e.jsxs("td",{className:"py-3 px-4 text-right font-medium",children:[t.price.toLocaleString()," VNĐ"]}),e.jsxs("td",{className:"py-3 px-4 text-right font-bold text-blue-600",children:[t.totalValue.toLocaleString()," VNĐ"]})]},t.id))})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Thao tác nhanh"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("a",{href:"/admin/medicine",className:"flex items-center p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-gray-50 transition-all",children:[e.jsx("i",{className:"fa-solid fa-pills text-gray-600 text-lg mr-3"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Quản lý thuốc"})]}),e.jsxs("a",{href:"/admin/inventory",className:"flex items-center p-4 border border-gray-200 rounded-lg hover:border-green-300 hover:bg-gray-50 transition-all",children:[e.jsx("i",{className:"fa-solid fa-truck-loading text-gray-600 text-lg mr-3"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Nhập kho"})]}),e.jsxs("a",{href:"/admin/inventory",className:"flex items-center p-4 border border-gray-200 rounded-lg hover:border-orange-300 hover:bg-gray-50 transition-all",children:[e.jsx("i",{className:"fa-solid fa-truck text-gray-600 text-lg mr-3"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Xuất kho"})]}),e.jsxs("a",{href:"/admin/medicine",className:"flex items-center p-4 border border-gray-200 rounded-lg hover:border-purple-300 hover:bg-gray-50 transition-all",children:[e.jsx("i",{className:"fa-solid fa-chart-line text-gray-600 text-lg mr-3"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Báo cáo"})]})]})]})]})};export{D as default};
