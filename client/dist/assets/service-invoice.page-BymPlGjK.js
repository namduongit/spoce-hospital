import{d as R,u as T,r as l,j as e}from"./index-wOwRfMo4.js";import{g as E}from"./medical-package.service-WOpOC3JI.js";import{c as D}from"./service-invoice.service-Bud_1WFk.js";import{g as F}from"./account.service-mdvzvQaG.js";const G=()=>{const x=R(),{execute:n,notify:g,loading:h}=T(),[u,b]=l.useState([]),[r,p]=l.useState([]),[f,o]=l.useState([]),[v,j]=l.useState(""),[c,d]=l.useState({patientName:"",patientPhone:"",userId:null,selectedPackages:[]}),N=async()=>{const s=await n(F());if(s?.result){const a=s.data;b(a)}},y=async()=>{const s=await n(E());if(s?.result){const a=s.data,t=Array.isArray(a)?a.filter(i=>i.status==="ACTIVE"):[];p(t),o(t)}},k=s=>{if(j(s),s==="")o(r);else{const a=r.filter(t=>t.name.toLowerCase().includes(s.toLowerCase())||t.description.toLowerCase().includes(s.toLowerCase()));o(a)}},P=s=>{d(a=>({...a,userId:s}))},w=s=>{if(!c.selectedPackages.some(a=>a.medicalPackageId===s.id)){const a={medicalPackageId:s.id},t=[...c.selectedPackages,a];d(i=>({...i,selectedPackages:t}))}},C=s=>{const a=c.selectedPackages.filter(t=>t.medicalPackageId!==s);d(t=>({...t,selectedPackages:a}))},m=(s,a)=>{d(t=>({...t,[s]:a}))},S=async()=>{const s=await n(D({patientName:c.patientName,patientPhone:c.patientPhone,userId:c.userId,medicalPackages:c.selectedPackages.map(a=>({medicalPackageId:a.medicalPackageId}))}));g(s,"Tạo hóa đơn dịch vụ thành công")},I=s=>s==="USER"?"Bệnh nhân":s==="DOCTOR"?"Bác sĩ":s==="ASSISTOR"?"Trợ lý":"Quản trị viên",A=c.selectedPackages.reduce((s,a)=>{const t=r.find(i=>i.id===a.medicalPackageId);return s+(t?t.price:0)},0),L=s=>r.find(a=>a.id===s);return l.useEffect(()=>{N(),y()},[]),e.jsx("main",{className:"create-service-invoice-page p-4 sm:p-6",children:e.jsxs("div",{className:"create-service-invoice-page__wrap max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-blue-700",children:"Tạo hóa đơn dịch vụ"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Tạo hóa đơn khám dịch vụ"})]}),e.jsxs("button",{onClick:()=>x("/doctor/service-invoice"),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:[e.jsx("i",{className:"fa-solid fa-arrow-left mr-2"}),"Quay lại"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fa-solid fa-user mr-2 text-blue-600"}),"Thông tin bệnh nhân"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Chọn tài khoản (tùy chọn)"}),e.jsxs("select",{value:c.userId||"",onChange:s=>P(s.target.value?Number(s.target.value):null),className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:h,children:[e.jsx("option",{value:"",children:"Không chọn tài khoản"}),u.map(s=>e.jsxs("option",{value:s.id,children:[s.id," - ",s.email," - ",I(s.role)]},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Họ tên"}),e.jsx("input",{type:"text",value:c.patientName,onChange:s=>m("patientName",s.target.value),className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nhập họ tên bệnh nhân"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Số điện thoại"}),e.jsx("input",{type:"text",value:c.patientPhone,onChange:s=>m("patientPhone",s.target.value),className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nhập số điện thoại"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fa-solid fa-medical-kit mr-2 text-blue-600"}),"Chọn gói dịch vụ"]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("i",{className:"fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"}),e.jsx("input",{type:"text",value:v,onChange:s=>k(s.target.value),className:"w-full border border-gray-300 rounded-md py-2 pl-10 pr-4 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Tìm kiếm gói dịch vụ..."})]}),e.jsx("div",{className:"max-h-90 overflow-y-auto space-y-2",children:f.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-md hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description}),e.jsxs("p",{className:"text-sm font-semibold text-blue-600",children:[s.price.toLocaleString("vi-VN")," đ"]})]}),e.jsxs("button",{onClick:()=>w(s),disabled:c.selectedPackages.some(a=>a.medicalPackageId===s.id),className:"ml-3 px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm font-medium disabled:bg-gray-300 disabled:cursor-not-allowed",children:[e.jsx("i",{className:"fa-solid fa-plus mr-1"}),"Thêm"]})]},s.id))})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"fa-solid fa-receipt mr-2 text-blue-600"}),"Chi tiết hóa đơn"]}),e.jsx("div",{className:"space-y-3 mb-4",children:c.selectedPackages.length>0?c.selectedPackages.map(s=>{const a=L(s.medicalPackageId);return a?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-md",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h6",{className:"font-medium text-gray-900",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.description}),e.jsx("p",{className:"text-sm text-gray-500",children:"Số lượng: 1 gói"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-semibold text-blue-600",children:[a.price.toLocaleString("vi-VN")," đ"]}),e.jsx("button",{onClick:()=>C(s.medicalPackageId),className:"text-red-600 hover:text-red-700 transition-colors",children:e.jsx("i",{className:"fa-solid fa-trash"})})]})]},s.medicalPackageId):null}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fa-solid fa-medical-kit text-3xl mb-2"}),e.jsx("p",{children:"Chưa chọn gói dịch vụ nào"})]})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Tổng cộng:"}),e.jsxs("span",{className:"text-xl font-bold text-blue-600",children:[A.toLocaleString("vi-VN")," đ"]})]}),e.jsxs("button",{onClick:S,className:"w-full bg-green-600 text-white py-3 px-4 rounded-md hover:bg-green-700 transition-colors font-semibold",children:[e.jsx("i",{className:"fa-solid fa-plus mr-2"}),"Tạo hóa đơn dịch vụ"]})]})]})})]})]})})};export{G as default};
