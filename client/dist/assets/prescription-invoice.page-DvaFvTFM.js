import{u as I,r as i,j as e}from"./index-wOwRfMo4.js";import{g as S}from"./prescription-invoice.service-BAoEDBLy.js";import{f as A}from"./format-date.util-D8g88DXU.js";import{p as E}from"./status.constant-BZ6KLHNH.js";import{P as T}from"./prescription-invoice.detail-CMmaOkvV.js";import{p as k}from"./report-print.service-Dl1us5Fl.js";const _=()=>{const{execute:m,notify:f}=I(),[r,j]=i.useState([]),[c,h]=i.useState([]),[b,g]=i.useState(!1),[u,N]=i.useState(null),[a,p]=i.useState({input:"",status:"",date:"",fromDate:"",toDate:""}),d=(s,t)=>{p(l=>({...l,[s]:t}))},x=async()=>{const s=await m(S());if(s?.result){const t=s.data,l=Array.isArray(t)?t:[];j(l),h(l)}},y=()=>{let s=r;a.input.trim()&&(s=s.filter(t=>t.patientName.toLowerCase().includes(a.input.toLowerCase())||t.patientPhone.includes(a.input)||t.id.toString().includes(a.input)||t.doctorEmail.toLowerCase().includes(a.input.toLowerCase()))),a.status&&(s=s.filter(t=>t.status===a.status)),a.fromDate&&(s=s.filter(t=>{const l=new Date(t.createAt),o=new Date(a.fromDate);return l>=o})),a.toDate&&(s=s.filter(t=>{const l=new Date(t.createAt),o=new Date(a.toDate);return o.setHours(23,59,59,999),l<=o})),a.date==="ASC"?s=s.slice().sort((t,l)=>new Date(t.createAt).getTime()-new Date(l.createAt).getTime()):a.date==="DESC"&&(s=s.slice().sort((t,l)=>new Date(l.createAt).getTime()-new Date(t.createAt).getTime())),h(s)};i.useEffect(()=>{x()},[]),i.useEffect(()=>{y()},[a,r]);const n={totalInvoices:r.length,totalAmount:r.reduce((s,t)=>s+(t.totalAmount||0),0),totalMedicines:r.reduce((s,t)=>s+(t.medicines?.length||0),0),pendingInvoices:r.filter(s=>s.status==="PENDING").length,paidInvoices:r.filter(s=>s.status==="PAID").length,cancelledInvoices:r.filter(s=>s.status==="CANCELLED").length,todayInvoices:r.filter(s=>{const t=new Date().toDateString();return new Date(s.createAt).toDateString()===t}).length},v=s=>{switch(s){case"PENDING":return"text-yellow-600 bg-yellow-100";case"PAID":return"text-green-600 bg-green-100";case"CANCELLED":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},w=s=>{switch(s){case"PENDING":return"Chờ xử lý";case"PAID":return"Đã hoàn thành";case"CANCELLED":return"Đã hủy";default:return s}},D=s=>{N(s),g(!0)},C=async s=>{const t=await m(k(s.id));f(t,"In hóa đơn thuốc thành công")};return e.jsxs("main",{className:"prescription-invoice-page p-4 sm:p-6",children:[e.jsxs("div",{className:"prescription-invoice-page__wrap max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-blue-700 mb-2 sm:mb-0",children:"Quản lý hóa đơn kê thuốc"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Quản lý hóa đơn kê thuốc của bác sĩ"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Tổng: ",e.jsx("span",{className:"font-semibold text-blue-600",children:n.totalInvoices})," hóa đơn"]}),e.jsxs("div",{children:["Hôm nay: ",e.jsx("span",{className:"font-semibold text-green-600",children:n.todayInvoices})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-receipt text-blue-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tổng hóa đơn"}),e.jsx("p",{className:"text-lg font-semibold",children:n.totalInvoices})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-clock text-yellow-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Chờ xử lý"}),e.jsx("p",{className:"text-lg font-semibold",children:n.pendingInvoices})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-check-circle text-green-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Đã hoàn thành"}),e.jsx("p",{className:"text-lg font-semibold",children:n.paidInvoices})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-times-circle text-red-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Đã hủy"}),e.jsx("p",{className:"text-lg font-semibold",children:n.cancelledInvoices})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-pills text-purple-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tổng thuốc"}),e.jsx("p",{className:"text-lg font-semibold",children:n.totalMedicines})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-money-bill text-orange-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Doanh thu"}),e.jsxs("p",{className:"text-lg font-semibold",children:[(n.totalAmount/1e6).toFixed(1),"M"]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:space-x-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Tìm kiếm"}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"}),e.jsx("input",{type:"text",className:"border border-gray-300 rounded-md py-2 pl-10 pr-4 text-sm w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Tìm theo tên bệnh nhân, bác sĩ, mã hóa đơn...",value:a.input,onChange:s=>d("input",s.target.value)})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Trạng thái"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",value:a.status,onChange:s=>d("status",s.target.value),children:[e.jsx("option",{value:"",children:"Chọn trạng thái"}),E.map(s=>e.jsx("option",{value:s.value,children:s.name},s.id))]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Sắp xếp theo"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",value:a.date,onChange:s=>d("date",s.target.value),children:[e.jsx("option",{value:"",children:"Sắp xếp theo ngày"}),e.jsx("option",{value:"DESC",children:"Mới nhất"}),e.jsx("option",{value:"ASC",children:"Cũ nhất"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-3 sm:space-x-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Từ ngày"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",value:a.fromDate,onChange:s=>d("fromDate",s.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Đến ngày"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",value:a.toDate,onChange:s=>d("toDate",s.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Hành động"}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("button",{className:`flex-1
                                    px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors text-sm font-medium`,onClick:x,children:[e.jsx("i",{className:"fa-solid fa-arrows-rotate"}),"Làm mới"]}),e.jsxs("button",{onClick:()=>{p({input:"",status:"",date:"",fromDate:"",toDate:""})},className:`flex-1
                                    px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors text-sm font-medium`,children:[e.jsx("i",{className:"fa-solid fa-times mr-1"}),"Xóa lọc"]})]})]})]})]}),e.jsxs("div",{className:"prescription-invoice__data bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Mã HĐ"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Tên bệnh nhân"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Số điện thoại"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Email bác sĩ"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Ngày tạo"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Trạng thái"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Tổng tiền"}),e.jsx("th",{className:"px-4 py-3 text-center font-medium text-gray-700",children:"Thao tác"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:c.length>0?c.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 font-medium text-blue-600",children:["#",s.id]}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:s.patientName}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.patientPhone}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.doctorEmail}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:A(new Date(s.createAt))}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${v(s.status)}`,children:w(s.status)})}),e.jsx("td",{className:"px-4 py-3 font-semibold text-blue-600",children:s.totalAmount.toLocaleString("vi-VN")}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("button",{onClick:()=>D(s),className:"px-3 py-1 bg-blue-100 text-blue-600 rounded hover:bg-blue-200 transition-colors text-xs font-medium",title:"Xem chi tiết",children:[e.jsx("i",{className:"fa-solid fa-eye mr-1"}),"Chi tiết"]}),e.jsxs("button",{onClick:()=>C(s),className:"px-3 py-1 bg-yellow-100 text-yellow-600 rounded hover:bg-yellow-200 transition-colors text-xs font-medium",title:"In hóa đơn",children:[e.jsx("i",{className:"fa-solid fa-edit mr-1"}),"In hóa đơn"]})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("i",{className:"fa-solid fa-prescription-bottle text-4xl mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:"Không có hóa đơn kê thuốc nào"}),e.jsx("p",{className:"text-sm mt-1",children:"Chưa có dữ liệu để hiển thị"})]})})})})]})}),c.length>0&&e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:["Hiển thị ",e.jsx("span",{className:"font-medium",children:c.length})," trên tổng số ",e.jsx("span",{className:"font-medium",children:r.length})," hóa đơn"]}),e.jsxs("span",{children:["Tổng giá trị: ",e.jsx("span",{className:"font-semibold text-blue-600",children:c.reduce((s,t)=>s+t.totalAmount,0).toLocaleString("vi-VN")})]})]})})]})]}),b&&u&&e.jsx(T,{prescriptionInvoiceSelect:u,setShowDetail:g,onSuccess:x})]})};export{_ as default};
